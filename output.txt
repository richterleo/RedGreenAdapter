/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/trl/trainer/dpo_trainer.py:332: UserWarning: When using DPODataCollatorWithPadding, you should set `remove_unused_columns=False` in your TrainingArguments we have set it for you, but you should do it yourself in the future.
  warnings.warn(
We are using wandb: wandb
Hello, we are now in the dpo training loop
We are using cuda: True
Define training arguments.
Block 1: 0.017150402069091797 seconds
Now loading the adapter model
Block 2: 0.6978602409362793 seconds
Now loading the basis model
Block 3: 2.2178683280944824 seconds
Now loading the tokenizer
Block 4: 0.21935772895812988 seconds
Now constructing the dataset
Block 5: 4.8725745677948 seconds
Now constructing the DPO Trainer
Map:   0%|          | 0/10000 [00:00<?, ? examples/s]Map:   0%|          | 45/10000 [00:00<00:30, 328.51 examples/s]Map:   1%|          | 93/10000 [00:00<00:24, 403.90 examples/s]Map:   1%|▏         | 138/10000 [00:00<00:23, 421.39 examples/s]Map:   2%|▏         | 185/10000 [00:00<00:22, 436.40 examples/s]Map:   2%|▏         | 230/10000 [00:00<00:22, 440.22 examples/s]Map:   3%|▎         | 307/10000 [00:00<00:20, 467.73 examples/s]Map:   4%|▎         | 356/10000 [00:00<00:20, 471.45 examples/s]Map:   4%|▍         | 410/10000 [00:00<00:19, 487.91 examples/s]Map:   5%|▍         | 466/10000 [00:01<00:21, 440.58 examples/s]Map:   5%|▌         | 533/10000 [00:01<00:21, 437.39 examples/s]Map:   6%|▌         | 579/10000 [00:01<00:21, 441.61 examples/s]Map:   6%|▋         | 626/10000 [00:01<00:20, 447.82 examples/s]Map:   7%|▋         | 702/10000 [00:01<00:21, 439.89 examples/s]Map:   8%|▊         | 752/10000 [00:01<00:20, 453.74 examples/s]Map:   8%|▊         | 799/10000 [00:01<00:20, 456.56 examples/s]Map:   8%|▊         | 846/10000 [00:01<00:22, 399.80 examples/s]Map:   9%|▉         | 913/10000 [00:02<00:22, 410.87 examples/s]Map:  10%|▉         | 963/10000 [00:02<00:20, 430.73 examples/s]Map:  10%|█         | 1016/10000 [00:02<00:31, 286.32 examples/s]Map:  11%|█         | 1056/10000 [00:02<00:29, 305.86 examples/s]Map:  11%|█▏        | 1125/10000 [00:02<00:25, 347.43 examples/s]Map:  12%|█▏        | 1172/10000 [00:02<00:23, 372.31 examples/s]Map:  12%|█▏        | 1217/10000 [00:02<00:22, 388.69 examples/s]Map:  13%|█▎        | 1264/10000 [00:03<00:23, 371.73 examples/s]Map:  13%|█▎        | 1310/10000 [00:03<00:22, 392.17 examples/s]Map:  14%|█▎        | 1355/10000 [00:03<00:21, 402.75 examples/s]Map:  14%|█▍        | 1422/10000 [00:03<00:20, 415.52 examples/s]Map:  15%|█▍        | 1465/10000 [00:03<00:20, 415.10 examples/s]Map:  15%|█▌        | 1520/10000 [00:03<00:18, 448.04 examples/s]Map:  16%|█▌        | 1566/10000 [00:03<00:18, 448.45 examples/s]Map:  16%|█▌        | 1621/10000 [00:03<00:20, 412.04 examples/s]Map:  17%|█▋        | 1681/10000 [00:04<00:19, 429.04 examples/s]Map:  17%|█▋        | 1733/10000 [00:04<00:20, 399.02 examples/s]Map:  18%|█▊        | 1782/10000 [00:04<00:19, 419.94 examples/s]Map:  18%|█▊        | 1840/10000 [00:04<00:17, 458.40 examples/s]Map:  19%|█▉        | 1908/10000 [00:04<00:17, 451.60 examples/s]Map:  20%|█▉        | 1957/10000 [00:04<00:19, 420.23 examples/s]Map:  20%|██        | 2000/10000 [00:04<00:26, 301.37 examples/s]Map:  20%|██        | 2036/10000 [00:05<00:27, 290.84 examples/s]Map:  21%|██        | 2080/10000 [00:05<00:24, 320.72 examples/s]Map:  21%|██▏       | 2128/10000 [00:05<00:22, 349.33 examples/s]Map:  22%|██▏       | 2176/10000 [00:05<00:20, 380.54 examples/s]Map:  22%|██▏       | 2221/10000 [00:05<00:19, 397.13 examples/s]Map:  23%|██▎       | 2265/10000 [00:05<00:19, 406.50 examples/s]Map:  23%|██▎       | 2313/10000 [00:05<00:18, 421.54 examples/s]Map:  24%|██▎       | 2362/10000 [00:05<00:17, 438.35 examples/s]Map:  24%|██▍       | 2420/10000 [00:06<00:19, 391.74 examples/s]Map:  25%|██▍       | 2462/10000 [00:06<00:19, 394.99 examples/s]Map:  25%|██▌       | 2506/10000 [00:06<00:18, 403.86 examples/s]Map:  26%|██▌       | 2584/10000 [00:06<00:16, 438.87 examples/s]Map:  26%|██▋       | 2646/10000 [00:06<00:17, 424.21 examples/s]Map:  27%|██▋       | 2697/10000 [00:06<00:16, 444.38 examples/s]Map:  27%|██▋       | 2748/10000 [00:06<00:16, 427.64 examples/s]Map:  28%|██▊       | 2797/10000 [00:06<00:16, 439.72 examples/s]Map:  29%|██▊       | 2852/10000 [00:07<00:17, 412.22 examples/s]Map:  29%|██▉       | 2903/10000 [00:07<00:16, 434.76 examples/s]Map:  30%|██▉       | 2975/10000 [00:07<00:15, 444.59 examples/s]Map:  30%|███       | 3033/10000 [00:07<00:21, 322.87 examples/s]Map:  31%|███       | 3079/10000 [00:07<00:19, 347.57 examples/s]Map:  31%|███▏      | 3125/10000 [00:07<00:18, 369.94 examples/s]Map:  32%|███▏      | 3172/10000 [00:07<00:19, 353.98 examples/s]Map:  32%|███▏      | 3216/10000 [00:08<00:18, 373.44 examples/s]Map:  33%|███▎      | 3258/10000 [00:08<00:17, 383.50 examples/s]Map:  33%|███▎      | 3307/10000 [00:08<00:16, 409.13 examples/s]Map:  34%|███▎      | 3353/10000 [00:08<00:15, 420.13 examples/s]Token indices sequence length is longer than the specified maximum sequence length for this model (1027 > 1024). Running this sequence through the model will result in indexing errors
Map:  34%|███▍      | 3410/10000 [00:08<00:15, 422.46 examples/s]Map:  35%|███▍      | 3465/10000 [00:08<00:16, 399.59 examples/s]Map:  35%|███▌      | 3539/10000 [00:08<00:15, 428.38 examples/s]Map:  36%|███▌      | 3584/10000 [00:08<00:14, 432.38 examples/s]Map:  36%|███▋      | 3629/10000 [00:08<00:14, 435.13 examples/s]Map:  37%|███▋      | 3690/10000 [00:09<00:16, 390.05 examples/s]Map:  37%|███▋      | 3738/10000 [00:09<00:15, 409.49 examples/s]Map:  38%|███▊      | 3783/10000 [00:09<00:14, 418.00 examples/s]Map:  38%|███▊      | 3836/10000 [00:09<00:15, 388.71 examples/s]Map:  39%|███▉      | 3880/10000 [00:09<00:15, 397.94 examples/s]Map:  39%|███▉      | 3940/10000 [00:09<00:15, 397.02 examples/s]Map:  40%|███▉      | 3989/10000 [00:09<00:14, 416.98 examples/s]Map:  40%|████      | 4033/10000 [00:10<00:21, 281.24 examples/s]Map:  41%|████      | 4085/10000 [00:10<00:18, 326.76 examples/s]Map:  41%|████▏     | 4130/10000 [00:10<00:16, 353.51 examples/s]Map:  42%|████▏     | 4188/10000 [00:10<00:16, 362.29 examples/s]Map:  42%|████▏     | 4233/10000 [00:10<00:15, 381.57 examples/s]Map:  43%|████▎     | 4288/10000 [00:10<00:14, 391.44 examples/s]Map:  43%|████▎     | 4340/10000 [00:10<00:13, 421.73 examples/s]Map:  44%|████▍     | 4388/10000 [00:10<00:12, 432.31 examples/s]Map:  44%|████▍     | 4445/10000 [00:11<00:11, 465.03 examples/s]Map:  45%|████▍     | 4494/10000 [00:11<00:11, 468.07 examples/s]Map:  46%|████▌     | 4554/10000 [00:11<00:12, 438.76 examples/s]Map:  46%|████▌     | 4601/10000 [00:11<00:12, 445.89 examples/s]Map:  46%|████▋     | 4647/10000 [00:11<00:12, 443.95 examples/s]Map:  47%|████▋     | 4719/10000 [00:11<00:12, 429.53 examples/s]Map:  48%|████▊     | 4764/10000 [00:11<00:12, 434.00 examples/s]Map:  48%|████▊     | 4813/10000 [00:11<00:11, 446.99 examples/s]Map:  49%|████▊     | 4859/10000 [00:12<00:11, 450.06 examples/s]Map:  49%|████▉     | 4932/10000 [00:12<00:10, 461.75 examples/s]Map:  50%|████▉     | 4989/10000 [00:12<00:11, 430.66 examples/s]Map:  50%|█████     | 5046/10000 [00:12<00:15, 311.58 examples/s]Map:  51%|█████     | 5101/10000 [00:12<00:15, 323.06 examples/s]Map:  51%|█████▏    | 5143/10000 [00:12<00:14, 340.70 examples/s]Map:  52%|█████▏    | 5183/10000 [00:13<00:13, 349.21 examples/s]Map:  52%|█████▏    | 5227/10000 [00:13<00:13, 346.83 examples/s]Map:  53%|█████▎    | 5276/10000 [00:13<00:12, 380.06 examples/s]Map:  54%|█████▎    | 5350/10000 [00:13<00:11, 416.22 examples/s]Map:  54%|█████▍    | 5394/10000 [00:13<00:10, 421.27 examples/s]Map:  54%|█████▍    | 5438/10000 [00:13<00:10, 424.27 examples/s]Map:  55%|█████▍    | 5498/10000 [00:13<00:10, 412.39 examples/s]Map:  55%|█████▌    | 5543/10000 [00:13<00:10, 421.20 examples/s]Map:  56%|█████▌    | 5611/10000 [00:13<00:10, 429.28 examples/s]Map:  57%|█████▋    | 5678/10000 [00:14<00:10, 401.15 examples/s]Map:  57%|█████▋    | 5728/10000 [00:14<00:11, 376.97 examples/s]Map:  58%|█████▊    | 5776/10000 [00:14<00:10, 398.85 examples/s]Map:  58%|█████▊    | 5821/10000 [00:14<00:10, 410.08 examples/s]Map:  59%|█████▊    | 5871/10000 [00:14<00:09, 430.34 examples/s]Map:  59%|█████▉    | 5936/10000 [00:14<00:10, 396.14 examples/s]Map:  60%|█████▉    | 5983/10000 [00:14<00:09, 411.72 examples/s]Map:  60%|██████    | 6031/10000 [00:15<00:13, 299.04 examples/s]Map:  61%|██████    | 6075/10000 [00:15<00:12, 311.65 examples/s]Map:  61%|██████    | 6121/10000 [00:15<00:11, 340.10 examples/s]Map:  62%|██████▏   | 6161/10000 [00:15<00:10, 352.97 examples/s]Map:  62%|██████▏   | 6211/10000 [00:15<00:09, 388.51 examples/s]Map:  63%|██████▎   | 6253/10000 [00:15<00:09, 395.01 examples/s]Map:  63%|██████▎   | 6304/10000 [00:15<00:08, 424.81 examples/s]Map:  64%|██████▍   | 6378/10000 [00:15<00:08, 447.36 examples/s]Map:  64%|██████▍   | 6443/10000 [00:16<00:08, 438.20 examples/s]Map:  65%|██████▌   | 6509/10000 [00:16<00:07, 437.50 examples/s]Map:  66%|██████▌   | 6559/10000 [00:16<00:08, 402.43 examples/s]Map:  66%|██████▌   | 6602/10000 [00:16<00:08, 407.24 examples/s]Map:  67%|██████▋   | 6656/10000 [00:16<00:08, 408.64 examples/s]Map:  67%|██████▋   | 6702/10000 [00:16<00:08, 372.73 examples/s]Map:  67%|██████▋   | 6744/10000 [00:16<00:08, 382.41 examples/s]Map:  68%|██████▊   | 6788/10000 [00:17<00:08, 394.61 examples/s]Map:  68%|██████▊   | 6835/10000 [00:17<00:07, 409.83 examples/s]Map:  69%|██████▉   | 6892/10000 [00:17<00:07, 398.05 examples/s]Map:  69%|██████▉   | 6936/10000 [00:17<00:08, 369.88 examples/s]Map:  70%|██████▉   | 6984/10000 [00:17<00:07, 394.14 examples/s]Map:  70%|███████   | 7030/10000 [00:17<00:10, 287.27 examples/s]Map:  71%|███████   | 7073/10000 [00:17<00:09, 300.36 examples/s]Map:  71%|███████   | 7124/10000 [00:18<00:09, 307.93 examples/s]Map:  72%|███████▏  | 7169/10000 [00:18<00:08, 336.57 examples/s]Map:  72%|███████▏  | 7213/10000 [00:18<00:07, 356.39 examples/s]Map:  73%|███████▎  | 7264/10000 [00:18<00:07, 364.44 examples/s]Map:  73%|███████▎  | 7303/10000 [00:18<00:07, 368.12 examples/s]Map:  73%|███████▎  | 7346/10000 [00:18<00:06, 382.52 examples/s]Map:  74%|███████▍  | 7390/10000 [00:18<00:06, 396.10 examples/s]Map:  75%|███████▍  | 7465/10000 [00:18<00:05, 430.78 examples/s]Map:  75%|███████▌  | 7514/10000 [00:19<00:06, 391.84 examples/s]Map:  76%|███████▌  | 7567/10000 [00:19<00:06, 390.17 examples/s]Map:  76%|███████▌  | 7614/10000 [00:19<00:05, 405.37 examples/s]Map:  77%|███████▋  | 7663/10000 [00:19<00:05, 422.09 examples/s]Map:  77%|███████▋  | 7716/10000 [00:19<00:05, 391.46 examples/s]Map:  78%|███████▊  | 7760/10000 [00:19<00:05, 398.61 examples/s]Map:  78%|███████▊  | 7834/10000 [00:19<00:05, 404.56 examples/s]Map:  79%|███████▉  | 7885/10000 [00:19<00:04, 423.50 examples/s]Map:  79%|███████▉  | 7930/10000 [00:20<00:04, 429.41 examples/s]Map:  80%|███████▉  | 7999/10000 [00:20<00:04, 432.97 examples/s]Map:  81%|████████  | 8064/10000 [00:20<00:06, 283.97 examples/s]Map:  81%|████████  | 8109/10000 [00:20<00:06, 311.35 examples/s]Map:  82%|████████▏ | 8155/10000 [00:20<00:06, 307.10 examples/s]Map:  82%|████████▏ | 8196/10000 [00:20<00:05, 326.79 examples/s]Map:  82%|████████▏ | 8240/10000 [00:21<00:05, 349.70 examples/s]Map:  83%|████████▎ | 8304/10000 [00:21<00:04, 373.32 examples/s]Map:  84%|████████▎ | 8357/10000 [00:21<00:04, 407.82 examples/s]Map:  84%|████████▍ | 8407/10000 [00:21<00:03, 424.30 examples/s]Map:  85%|████████▍ | 8473/10000 [00:21<00:03, 405.71 examples/s]Map:  85%|████████▌ | 8526/10000 [00:21<00:03, 387.16 examples/s]Map:  86%|████████▌ | 8573/10000 [00:21<00:03, 403.98 examples/s]Map:  86%|████████▌ | 8619/10000 [00:21<00:03, 416.77 examples/s]Map:  87%|████████▋ | 8690/10000 [00:22<00:03, 428.64 examples/s]Map:  87%|████████▋ | 8739/10000 [00:22<00:03, 390.80 examples/s]Map:  88%|████████▊ | 8793/10000 [00:22<00:03, 396.73 examples/s]Map:  88%|████████▊ | 8844/10000 [00:22<00:02, 422.11 examples/s]Map:  89%|████████▉ | 8895/10000 [00:22<00:02, 392.56 examples/s]Map:  89%|████████▉ | 8945/10000 [00:22<00:02, 414.16 examples/s]Map:  90%|█████████ | 9000/10000 [00:23<00:03, 278.80 examples/s]Map:  90%|█████████ | 9043/10000 [00:23<00:03, 303.53 examples/s]Map:  91%|█████████ | 9082/10000 [00:23<00:02, 320.07 examples/s]Map:  91%|█████████▏| 9134/10000 [00:23<00:02, 364.29 examples/s]Map:  92%|█████████▏| 9187/10000 [00:23<00:02, 354.59 examples/s]Map:  92%|█████████▏| 9231/10000 [00:23<00:02, 371.99 examples/s]Map:  93%|█████████▎| 9275/10000 [00:23<00:01, 385.84 examples/s]Map:  93%|█████████▎| 9330/10000 [00:23<00:01, 398.18 examples/s]Map:  94%|█████████▍| 9378/10000 [00:24<00:01, 361.45 examples/s]Map:  94%|█████████▍| 9431/10000 [00:24<00:01, 365.95 examples/s]Map:  95%|█████████▍| 9475/10000 [00:24<00:01, 383.20 examples/s]Map:  95%|█████████▌| 9528/10000 [00:24<00:01, 419.38 examples/s]Map:  96%|█████████▌| 9580/10000 [00:24<00:00, 444.78 examples/s]Map:  96%|█████████▋| 9632/10000 [00:24<00:00, 407.31 examples/s]Map:  97%|█████████▋| 9680/10000 [00:24<00:00, 423.63 examples/s]Map:  97%|█████████▋| 9748/10000 [00:24<00:00, 421.86 examples/s]Map:  98%|█████████▊| 9816/10000 [00:25<00:00, 404.83 examples/s]Map:  99%|█████████▊| 9866/10000 [00:25<00:00, 380.87 examples/s]Map:  99%|█████████▉| 9921/10000 [00:25<00:00, 416.72 examples/s]Map: 100%|█████████▉| 9976/10000 [00:25<00:00, 442.52 examples/s]Map: 100%|██████████| 10000/10000 [00:25<00:00, 389.21 examples/s]
Map:   0%|          | 0/8552 [00:00<?, ? examples/s]Map:   1%|          | 61/8552 [00:00<00:17, 491.09 examples/s]Map:   1%|▏         | 112/8552 [00:00<00:17, 495.88 examples/s]Map:   2%|▏         | 166/8552 [00:00<00:20, 418.36 examples/s]Map:   3%|▎         | 216/8552 [00:00<00:18, 443.89 examples/s]Map:   3%|▎         | 284/8552 [00:00<00:18, 443.77 examples/s]Map:   4%|▍         | 331/8552 [00:00<00:18, 449.80 examples/s]Map:   5%|▍         | 390/8552 [00:00<00:20, 391.65 examples/s]Map:   5%|▌         | 432/8552 [00:01<00:20, 397.48 examples/s]Map:   6%|▌         | 483/8552 [00:01<00:18, 425.80 examples/s]Map:   6%|▌         | 531/8552 [00:01<00:18, 439.24 examples/s]Map:   7%|▋         | 587/8552 [00:01<00:19, 413.31 examples/s]Map:   7%|▋         | 632/8552 [00:01<00:18, 421.27 examples/s]Map:   8%|▊         | 703/8552 [00:01<00:18, 432.50 examples/s]Map:   9%|▊         | 747/8552 [00:01<00:18, 429.16 examples/s]Map:  10%|▉         | 817/8552 [00:01<00:18, 412.49 examples/s]Map:  10%|█         | 863/8552 [00:02<00:18, 419.10 examples/s]Map:  11%|█         | 914/8552 [00:02<00:19, 390.58 examples/s]Map:  11%|█▏        | 982/8552 [00:02<00:18, 403.28 examples/s]Map:  12%|█▏        | 1056/8552 [00:02<00:25, 290.57 examples/s]Map:  13%|█▎        | 1106/8552 [00:02<00:22, 324.44 examples/s]Map:  14%|█▎        | 1159/8552 [00:02<00:22, 331.12 examples/s]Map:  14%|█▍        | 1215/8552 [00:03<00:21, 341.20 examples/s]Map:  15%|█▍        | 1267/8552 [00:03<00:19, 376.24 examples/s]Map:  15%|█▌        | 1312/8552 [00:03<00:18, 391.63 examples/s]Map:  16%|█▌        | 1361/8552 [00:03<00:19, 367.57 examples/s]Map:  16%|█▋        | 1404/8552 [00:03<00:18, 378.93 examples/s]Map:  17%|█▋        | 1449/8552 [00:03<00:17, 395.95 examples/s]Map:  17%|█▋        | 1495/8552 [00:03<00:17, 408.85 examples/s]Map:  18%|█▊        | 1550/8552 [00:03<00:16, 413.16 examples/s]Map:  19%|█▊        | 1597/8552 [00:04<00:18, 374.99 examples/s]Map:  19%|█▉        | 1646/8552 [00:04<00:17, 398.46 examples/s]Map:  20%|██        | 1713/8552 [00:04<00:24, 284.69 examples/s]Map:  21%|██        | 1754/8552 [00:04<00:22, 306.56 examples/s]Map:  21%|██        | 1802/8552 [00:04<00:19, 339.53 examples/s]Map:  22%|██▏       | 1848/8552 [00:04<00:19, 341.94 examples/s]Map:  22%|██▏       | 1893/8552 [00:04<00:18, 366.85 examples/s]Map:  23%|██▎       | 1963/8552 [00:05<00:16, 395.96 examples/s]Map:  24%|██▎       | 2016/8552 [00:05<00:24, 261.60 examples/s]Map:  24%|██▍       | 2059/8552 [00:05<00:22, 289.63 examples/s]Map:  25%|██▍       | 2100/8552 [00:05<00:20, 312.64 examples/s]Map:  25%|██▌       | 2155/8552 [00:05<00:18, 344.54 examples/s]Map:  26%|██▌       | 2199/8552 [00:05<00:19, 326.98 examples/s]Map:  26%|██▋       | 2250/8552 [00:06<00:17, 366.90 examples/s]Map:  27%|██▋       | 2309/8552 [00:06<00:16, 373.47 examples/s]Map:  28%|██▊       | 2354/8552 [00:06<00:15, 390.42 examples/s]Map:  28%|██▊       | 2397/8552 [00:06<00:17, 353.27 examples/s]Map:  29%|██▊       | 2439/8552 [00:06<00:16, 366.61 examples/s]Map:  29%|██▉       | 2490/8552 [00:06<00:18, 330.49 examples/s]Map:  30%|██▉       | 2531/8552 [00:06<00:17, 346.63 examples/s]Map:  30%|███       | 2590/8552 [00:07<00:16, 360.19 examples/s]Map:  31%|███       | 2633/8552 [00:07<00:17, 334.36 examples/s]Map:  31%|███▏      | 2674/8552 [00:07<00:16, 348.67 examples/s]Map:  32%|███▏      | 2714/8552 [00:07<00:16, 358.16 examples/s]Map:  32%|███▏      | 2775/8552 [00:07<00:15, 371.59 examples/s]Map:  33%|███▎      | 2817/8552 [00:07<00:16, 357.02 examples/s]Map:  34%|███▎      | 2879/8552 [00:07<00:15, 372.61 examples/s]Map:  34%|███▍      | 2925/8552 [00:07<00:16, 350.98 examples/s]Map:  35%|███▍      | 2967/8552 [00:08<00:15, 363.35 examples/s]Map:  35%|███▌      | 3024/8552 [00:08<00:21, 257.62 examples/s]Map:  36%|███▌      | 3062/8552 [00:08<00:19, 277.73 examples/s]Map:  36%|███▌      | 3099/8552 [00:08<00:18, 296.17 examples/s]Map:  37%|███▋      | 3138/8552 [00:08<00:17, 311.44 examples/s]Map:  37%|███▋      | 3182/8552 [00:08<00:15, 341.75 examples/s]Map:  38%|███▊      | 3229/8552 [00:08<00:16, 328.60 examples/s]Map:  38%|███▊      | 3269/8552 [00:09<00:15, 344.56 examples/s]Map:  39%|███▉      | 3317/8552 [00:09<00:14, 353.21 examples/s]Map:  39%|███▉      | 3355/8552 [00:09<00:14, 359.08 examples/s]Map:  40%|███▉      | 3400/8552 [00:09<00:15, 332.48 examples/s]Map:  40%|████      | 3436/8552 [00:09<00:15, 335.16 examples/s]Map:  41%|████      | 3478/8552 [00:09<00:14, 355.86 examples/s]Map:  41%|████      | 3525/8552 [00:09<00:13, 384.02 examples/s]Map:  42%|████▏     | 3583/8552 [00:09<00:13, 359.49 examples/s]Map:  43%|████▎     | 3646/8552 [00:10<00:13, 372.96 examples/s]Map:  43%|████▎     | 3691/8552 [00:10<00:12, 390.73 examples/s]Map:  44%|████▎     | 3736/8552 [00:10<00:13, 351.77 examples/s]Map:  44%|████▍     | 3788/8552 [00:10<00:13, 361.89 examples/s]Map:  45%|████▍     | 3837/8552 [00:10<00:13, 347.69 examples/s]Map:  45%|████▌     | 3880/8552 [00:10<00:12, 362.43 examples/s]Map:  46%|████▌     | 3930/8552 [00:10<00:12, 361.04 examples/s]Map:  46%|████▋     | 3967/8552 [00:11<00:12, 362.78 examples/s]Map:  47%|████▋     | 4014/8552 [00:11<00:19, 233.90 examples/s]Map:  47%|████▋     | 4051/8552 [00:11<00:17, 255.54 examples/s]Map:  48%|████▊     | 4094/8552 [00:11<00:15, 290.12 examples/s]Map:  48%|████▊     | 4130/8552 [00:11<00:14, 304.38 examples/s]Map:  49%|████▉     | 4179/8552 [00:11<00:13, 328.62 examples/s]Map:  49%|████▉     | 4216/8552 [00:11<00:14, 299.51 examples/s]Map:  50%|████▉     | 4258/8552 [00:12<00:13, 325.35 examples/s]Map:  50%|█████     | 4295/8552 [00:12<00:12, 334.79 examples/s]Map:  51%|█████     | 4336/8552 [00:12<00:12, 347.85 examples/s]Map:  51%|█████▏    | 4390/8552 [00:12<00:11, 366.72 examples/s]Map:  52%|█████▏    | 4438/8552 [00:12<00:12, 341.58 examples/s]Map:  53%|█████▎    | 4492/8552 [00:12<00:11, 343.57 examples/s]Map:  53%|█████▎    | 4537/8552 [00:12<00:10, 368.15 examples/s]Map:  54%|█████▎    | 4579/8552 [00:12<00:10, 380.42 examples/s]Map:  54%|█████▍    | 4619/8552 [00:13<00:10, 379.35 examples/s]Map:  54%|█████▍    | 4659/8552 [00:13<00:10, 359.20 examples/s]Map:  55%|█████▍    | 4703/8552 [00:13<00:13, 290.66 examples/s]Map:  55%|█████▌    | 4736/8552 [00:13<00:15, 252.69 examples/s]Map:  56%|█████▌    | 4766/8552 [00:13<00:16, 230.34 examples/s]Map:  56%|█████▌    | 4798/8552 [00:13<00:16, 222.05 examples/s]Map:  56%|█████▋    | 4824/8552 [00:14<00:17, 217.10 examples/s]Map:  57%|█████▋    | 4848/8552 [00:14<00:19, 193.97 examples/s]Map:  57%|█████▋    | 4878/8552 [00:14<00:18, 193.85 examples/s]Map:  57%|█████▋    | 4901/8552 [00:14<00:19, 190.07 examples/s]Map:  58%|█████▊    | 4936/8552 [00:14<00:18, 200.76 examples/s]Map:  58%|█████▊    | 4962/8552 [00:14<00:18, 190.65 examples/s]Map:  58%|█████▊    | 4984/8552 [00:14<00:18, 196.31 examples/s]Map:  59%|█████▊    | 5013/8552 [00:15<00:27, 128.83 examples/s]Map:  59%|█████▉    | 5033/8552 [00:15<00:25, 138.68 examples/s]Map:  59%|█████▉    | 5060/8552 [00:15<00:23, 147.89 examples/s]Map:  59%|█████▉    | 5088/8552 [00:15<00:23, 147.82 examples/s]Map:  60%|█████▉    | 5110/8552 [00:15<00:22, 149.87 examples/s]Map:  60%|█████▉    | 5130/8552 [00:15<00:21, 159.88 examples/s]Map:  60%|██████    | 5161/8552 [00:16<00:19, 171.30 examples/s]Map:  61%|██████    | 5182/8552 [00:16<00:18, 178.03 examples/s]Map:  61%|██████    | 5207/8552 [00:16<00:17, 192.25 examples/s]Map:  61%|██████    | 5234/8552 [00:16<00:18, 175.68 examples/s]Map:  61%|██████▏   | 5259/8552 [00:16<00:17, 192.37 examples/s]Map:  62%|██████▏   | 5281/8552 [00:16<00:16, 194.53 examples/s]Map:  62%|██████▏   | 5303/8552 [00:16<00:18, 177.47 examples/s]Map:  62%|██████▏   | 5332/8552 [00:17<00:17, 181.07 examples/s]Map:  63%|██████▎   | 5353/8552 [00:17<00:18, 172.91 examples/s]Map:  63%|██████▎   | 5379/8552 [00:17<00:16, 192.15 examples/s]Map:  63%|██████▎   | 5405/8552 [00:17<00:17, 182.18 examples/s]Map:  64%|██████▎   | 5433/8552 [00:17<00:16, 187.10 examples/s]Map:  64%|██████▍   | 5463/8552 [00:17<00:16, 188.16 examples/s]Map:  64%|██████▍   | 5483/8552 [00:17<00:18, 169.07 examples/s]Map:  64%|██████▍   | 5505/8552 [00:17<00:17, 178.69 examples/s]Map:  65%|██████▍   | 5534/8552 [00:18<00:15, 192.93 examples/s]Map:  65%|██████▍   | 5557/8552 [00:18<00:14, 199.97 examples/s]Map:  65%|██████▌   | 5579/8552 [00:18<00:14, 202.80 examples/s]Map:  66%|██████▌   | 5603/8552 [00:18<00:16, 183.97 examples/s]Map:  66%|██████▌   | 5629/8552 [00:18<00:15, 187.68 examples/s]Map:  66%|██████▌   | 5653/8552 [00:18<00:16, 172.17 examples/s]Map:  66%|██████▋   | 5675/8552 [00:18<00:17, 166.16 examples/s]Map:  67%|██████▋   | 5695/8552 [00:19<00:18, 155.04 examples/s]Map:  67%|██████▋   | 5720/8552 [00:19<00:17, 163.72 examples/s]Map:  67%|██████▋   | 5741/8552 [00:19<00:16, 169.84 examples/s]Map:  67%|██████▋   | 5763/8552 [00:19<00:15, 179.06 examples/s]Map:  68%|██████▊   | 5783/8552 [00:19<00:18, 152.08 examples/s]Map:  68%|██████▊   | 5802/8552 [00:19<00:19, 140.73 examples/s]Map:  68%|██████▊   | 5842/8552 [00:19<00:14, 184.08 examples/s]Map:  69%|██████▊   | 5867/8552 [00:20<00:13, 197.87 examples/s]Map:  69%|██████▉   | 5896/8552 [00:20<00:12, 216.99 examples/s]Map:  69%|██████▉   | 5923/8552 [00:20<00:11, 229.39 examples/s]Map:  70%|██████▉   | 5954/8552 [00:20<00:10, 249.38 examples/s]Map:  70%|███████   | 5990/8552 [00:20<00:09, 256.77 examples/s]Map:  71%|███████   | 6042/8552 [00:20<00:14, 168.83 examples/s]Map:  71%|███████   | 6076/8552 [00:21<00:12, 196.05 examples/s]Map:  71%|███████▏  | 6106/8552 [00:21<00:11, 212.20 examples/s]Map:  72%|███████▏  | 6141/8552 [00:21<00:10, 237.42 examples/s]Map:  72%|███████▏  | 6171/8552 [00:21<00:09, 250.42 examples/s]Map:  72%|███████▏  | 6200/8552 [00:21<00:09, 244.07 examples/s]Map:  73%|███████▎  | 6233/8552 [00:21<00:08, 263.79 examples/s]Map:  73%|███████▎  | 6281/8552 [00:21<00:08, 279.22 examples/s]Map:  74%|███████▍  | 6314/8552 [00:21<00:07, 290.09 examples/s]Map:  74%|███████▍  | 6359/8552 [00:21<00:07, 288.83 examples/s]Map:  75%|███████▍  | 6411/8552 [00:22<00:06, 313.13 examples/s]Map:  75%|███████▌  | 6452/8552 [00:22<00:07, 296.00 examples/s]Map:  76%|███████▌  | 6501/8552 [00:22<00:06, 304.27 examples/s]Map:  76%|███████▋  | 6541/8552 [00:22<00:06, 288.62 examples/s]Map:  77%|███████▋  | 6577/8552 [00:22<00:06, 288.23 examples/s]Map:  77%|███████▋  | 6608/8552 [00:22<00:06, 287.03 examples/s]Map:  78%|███████▊  | 6647/8552 [00:22<00:06, 306.06 examples/s]Map:  78%|███████▊  | 6683/8552 [00:23<00:06, 281.27 examples/s]Map:  79%|███████▊  | 6715/8552 [00:23<00:06, 289.90 examples/s]Map:  79%|███████▉  | 6746/8552 [00:23<00:06, 293.21 examples/s]Map:  79%|███████▉  | 6782/8552 [00:23<00:06, 291.89 examples/s]Map:  80%|███████▉  | 6812/8552 [00:23<00:05, 292.69 examples/s]Map:  80%|████████  | 6850/8552 [00:23<00:06, 276.30 examples/s]Map:  81%|████████  | 6891/8552 [00:23<00:05, 308.34 examples/s]Map:  81%|████████  | 6944/8552 [00:23<00:04, 323.21 examples/s]Map:  82%|████████▏ | 6978/8552 [00:24<00:04, 325.72 examples/s]Map:  82%|████████▏ | 7024/8552 [00:24<00:07, 199.57 examples/s]Map:  83%|████████▎ | 7061/8552 [00:24<00:06, 217.30 examples/s]Map:  83%|████████▎ | 7088/8552 [00:24<00:06, 225.96 examples/s]Map:  83%|████████▎ | 7115/8552 [00:24<00:06, 234.02 examples/s]Map:  84%|████████▎ | 7148/8552 [00:24<00:05, 255.89 examples/s]Map:  84%|████████▍ | 7181/8552 [00:24<00:05, 271.79 examples/s]Map:  84%|████████▍ | 7215/8552 [00:25<00:04, 288.87 examples/s]Map:  85%|████████▍ | 7259/8552 [00:25<00:04, 288.87 examples/s]Map:  85%|████████▌ | 7293/8552 [00:25<00:04, 296.99 examples/s]Map:  86%|████████▌ | 7326/8552 [00:25<00:04, 283.61 examples/s]Map:  86%|████████▌ | 7358/8552 [00:25<00:04, 291.09 examples/s]Map:  87%|████████▋ | 7405/8552 [00:25<00:03, 296.67 examples/s]Map:  87%|████████▋ | 7441/8552 [00:25<00:03, 281.36 examples/s]Map:  87%|████████▋ | 7471/8552 [00:25<00:03, 281.98 examples/s]Map:  88%|████████▊ | 7503/8552 [00:26<00:03, 288.67 examples/s]Map:  88%|████████▊ | 7551/8552 [00:26<00:03, 304.65 examples/s]Map:  89%|████████▊ | 7583/8552 [00:26<00:03, 305.20 examples/s]Map:  89%|████████▉ | 7621/8552 [00:26<00:02, 321.52 examples/s]Map:  90%|████████▉ | 7662/8552 [00:26<00:02, 300.34 examples/s]Map:  90%|█████████ | 7700/8552 [00:26<00:02, 315.54 examples/s]Map:  91%|█████████ | 7743/8552 [00:26<00:02, 319.04 examples/s]Map:  91%|█████████ | 7785/8552 [00:26<00:02, 303.31 examples/s]Map:  92%|█████████▏| 7831/8552 [00:27<00:02, 301.17 examples/s]Map:  92%|█████████▏| 7872/8552 [00:27<00:02, 290.82 examples/s]Map:  92%|█████████▏| 7910/8552 [00:27<00:02, 304.25 examples/s]Map:  93%|█████████▎| 7948/8552 [00:27<00:01, 321.47 examples/s]Map:  93%|█████████▎| 7988/8552 [00:27<00:01, 316.90 examples/s]Map:  94%|█████████▍| 8038/8552 [00:28<00:02, 206.88 examples/s]Map:  94%|█████████▍| 8065/8552 [00:28<00:02, 216.43 examples/s]Map:  95%|█████████▍| 8096/8552 [00:28<00:01, 233.05 examples/s]Map:  95%|█████████▍| 8124/8552 [00:28<00:01, 241.67 examples/s]Map:  95%|█████████▌| 8156/8552 [00:28<00:01, 258.52 examples/s]Map:  96%|█████████▌| 8194/8552 [00:28<00:01, 255.84 examples/s]Map:  96%|█████████▌| 8230/8552 [00:28<00:01, 279.54 examples/s]Map:  97%|█████████▋| 8274/8552 [00:28<00:00, 295.23 examples/s]Map:  97%|█████████▋| 8316/8552 [00:28<00:00, 286.84 examples/s]Map:  98%|█████████▊| 8347/8552 [00:29<00:00, 287.15 examples/s]Map:  98%|█████████▊| 8382/8552 [00:29<00:00, 299.45 examples/s]Map:  99%|█████████▊| 8428/8552 [00:29<00:00, 314.81 examples/s]Map:  99%|█████████▉| 8473/8552 [00:29<00:00, 302.72 examples/s]Map: 100%|█████████▉| 8524/8552 [00:29<00:00, 313.59 examples/s]Map: 100%|██████████| 8552/8552 [00:29<00:00, 286.06 examples/s]
/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/accelerate/accelerator.py:432: FutureWarning: Passing the following arguments to `Accelerator` is deprecated and will be removed in version 1.0 of Accelerate: dict_keys(['dispatch_batches', 'split_batches', 'even_batches', 'use_seedable_sampler']). Please pass an `accelerate.DataLoaderConfiguration` instead: 
dataloader_config = DataLoaderConfiguration(dispatch_batches=None, split_batches=False, even_batches=True, use_seedable_sampler=True)
  warnings.warn(
Detected kernel version 5.4.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
max_steps is given, it will override any value given in num_train_epochs
Currently training with a batch size of: 1
***** Running training *****
  Num examples = 10,000
  Num Epochs = 1
  Instantaneous batch size per device = 1
  Total train batch size (w. parallel, distributed & accumulation) = 1
  Gradient Accumulation steps = 1
  Total optimization steps = 10,000
  Number of trainable parameters = 124,439,808
Automatic Weights & Biases logging enabled, to disable set os.environ["WANDB_DISABLED"] = "true"
wandb: Currently logged in as: richter-leo94. Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.16.5
wandb: Run data is saved locally in /root/RedGreenAdapter/wandb/run-20240402_114241-abh21q36
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run run_2024-04-02_11:41:27
wandb: ⭐️ View project at https://wandb.ai/richter-leo94/RedGreen_Adapter
wandb: 🚀 View run at https://wandb.ai/richter-leo94/RedGreen_Adapter/runs/abh21q36/workspace
Block 6: 63.71364402770996 seconds
Now starting the training
  0%|          | 0/10000 [00:00<?, ?it/s]Could not estimate the number of tokens of the input, floating-point operations will not be computed
  0%|          | 1/10000 [00:01<3:32:53,  1.28s/it]  0%|          | 2/10000 [00:01<2:35:19,  1.07it/s]  0%|          | 3/10000 [00:02<2:02:25,  1.36it/s]  0%|          | 4/10000 [00:03<2:19:51,  1.19it/s]  0%|          | 5/10000 [00:04<2:17:28,  1.21it/s]  0%|          | 6/10000 [00:04<1:56:49,  1.43it/s]  0%|          | 7/10000 [00:05<2:04:20,  1.34it/s]  0%|          | 8/10000 [00:06<2:03:59,  1.34it/s]Block 7: 12.470032930374146 seconds
Traceback (most recent call last):
  File "/root/RedGreenAdapter/main.py", line 68, in <module>
    run_name = train_dpo(config_dict, DPOArgs, training_args)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/RedGreenAdapter/train.py", line 280, in train_dpo
    trainer.train()
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/transformers/trainer.py", line 1780, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/transformers/trainer.py", line 2118, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/transformers/trainer.py", line 3036, in training_step
    loss = self.compute_loss(model, inputs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/trl/trainer/dpo_trainer.py", line 1081, in compute_loss
    loss, metrics = self.get_batch_loss_metrics(model, inputs, train_eval="train")
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/trl/trainer/dpo_trainer.py", line 1022, in get_batch_loss_metrics
    ) = self.concatenated_forward(model, batch)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/RedGreenAdapter/DPO_adapter.py", line 93, in concatenated_forward
    all_logits_basis_model = self.basis_model(
                             ^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 822, in forward
    return model_forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/accelerate/utils/operations.py", line 810, in __call__
    return convert_to_fp32(self.model_forward(*args, **kwargs))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/torch/amp/autocast_mode.py", line 16, in decorate_autocast
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/transformers/models/gpt2/modeling_gpt2.py", line 1096, in forward
    lm_logits = self.lm_head(hidden_states)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1511, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1520, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/torch/nn/modules/linear.py", line 116, in forward
    return F.linear(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 124.00 MiB. GPU 0 has a total capacity of 23.68 GiB of which 117.94 MiB is free. Process 4097650 has 18.02 GiB memory in use. Process 4133144 has 5.54 GiB memory in use. Of the allocated memory 5.00 GiB is allocated by PyTorch, and 290.88 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
wandb: - 0.003 MB of 0.003 MB uploadedwandb: \ 0.003 MB of 0.003 MB uploadedwandb: | 0.003 MB of 0.023 MB uploadedwandb: / 0.023 MB of 0.023 MB uploadedwandb: 🚀 View run run_2024-04-02_11:41:27 at: https://wandb.ai/richter-leo94/RedGreen_Adapter/runs/abh21q36/workspace
wandb: Synced 6 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240402_114241-abh21q36/logs
Traceback (most recent call last):
  File "/opt/conda/envs/redgreenvenv/bin/accelerate", line 8, in <module>
    sys.exit(main())
             ^^^^^^
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/accelerate/commands/accelerate_cli.py", line 46, in main
    args.func(args)
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/accelerate/commands/launch.py", line 1057, in launch_command
    simple_launcher(args)
  File "/opt/conda/envs/redgreenvenv/lib/python3.12/site-packages/accelerate/commands/launch.py", line 673, in simple_launcher
    raise subprocess.CalledProcessError(returncode=process.returncode, cmd=cmd)
subprocess.CalledProcessError: Command '['/opt/conda/envs/redgreenvenv/bin/python', 'main.py']' returned non-zero exit status 1.
